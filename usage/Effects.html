<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Async Effects | Diode</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.5.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-prism/prism.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../advanced/index.html" />
    
    
    <link rel="prev" href="../usage/Views.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="1.5" data-chapter-title="Async Effects" data-filepath="usage/Effects.md" data-basepath=".." data-revision="Mon Nov 30 2015 14:42:05 GMT+0200 (FLE Standard Time)">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="usage/index.html">
            
                
                    <a href="../usage/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Usage
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="usage/ApplicationModel.html">
            
                
                    <a href="../usage/ApplicationModel.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Application Model
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="usage/Actions.html">
            
                
                    <a href="../usage/Actions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Actions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="usage/Handlers.html">
            
                
                    <a href="../usage/Handlers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Action Handlers
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="usage/Views.html">
            
                
                    <a href="../usage/Views.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Views
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="1.5" data-path="usage/Effects.html">
            
                
                    <a href="../usage/Effects.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Async Effects
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="advanced/index.html">
            
                
                    <a href="../advanced/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Advanced Topics
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="advanced/Pot.html">
            
                
                    <a href="../advanced/Pot.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Async Model Data
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="advanced/PotActions.html">
            
                
                    <a href="../advanced/PotActions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Stateful Actions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="advanced/ActionProcessors.html">
            
                
                    <a href="../advanced/ActionProcessors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Action Processors
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="UsageWithReact.html">
            
                
                    <a href="../UsageWithReact.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Usage with React
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Diode</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="async-effects">Async Effects</h1>
<p><img src="../images/architecture-effect.png" style="float: right; padding: 10px">
Action handlers in Diode are <em>pure functions</em>, meaning they can just do computation based on the action and the current model. Side effects, such as making a
request to the server, are not allowed. This restriction is mainly to make testing of handlers easier, when they behave in a predictable fashion.</p>
<p>So how do you then perform async requests in a Diode application? In Redux this is solved by placing the async calls into <em>action creators</em>, functions that 
return actions. While this keeps action handlers pure, it makes the application design fragmented. In Diode we follow in the footsteps of Elm by wrapping any
side effects into <code>Effect</code>s and returning them from the action handler with the updated model.</p>
<h2 id="what-is-an-effect">What is an Effect?</h2>
<p>In an Effect we <em>describe</em> a computation instead of directly <em>executing</em> it. It&apos;s quite similar to the <code>IO</code> concept in Scalaz/Haskell but with a very
straightforward implementation:</p>
<pre><code class="lang-scala"><span class="token keyword">type</span> Effect<span class="token punctuation">[</span>Action <span class="token operator">&lt;</span><span class="token operator">:</span> <span class="token builtin">AnyRef</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> Future<span class="token punctuation">[</span>Action<span class="token punctuation">]</span>
</code></pre>
<p>It&apos;s just a function returning a <code>Future[Action]</code>. The action returned by the <code>Future</code> is automatically dispatched. If your effect doesn&apos;t need anything
dispatched, return a <code>None</code>.</p>
<h3 id="using-effects">Using Effects</h3>
<p>To create an effect you need a function that runs something asynchronously, for example performing an Ajax call.</p>
<pre><code class="lang-scala"><span class="token keyword">import</span> org<span class="token punctuation">.</span>scalajs<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>Ajax

<span class="token keyword">case</span> <span class="token keyword">class</span> NewMessages<span class="token punctuation">(</span>msgs<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> loadMessagesEffect<span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token operator">=</span> 
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> Ajax<span class="token punctuation">.</span>get<span class="token punctuation">(</span>s<span class="token string">&quot;/user/messages?id=$user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>r <span class="token keyword">=&gt;</span> NewMessages<span class="token punctuation">(</span>r<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>Here the <code>loadMessagesEffect</code> doesn&apos;t actually execute the Ajax call immediately, but just provides a function to do so. Once the future does complete, the
result is mapped into a <code>NewMessages</code> action that gets automatically dispatched.</p>
<p>To return the effects alongside the new model, use one of the helper functions provided by <code>ActionHandler</code>.</p>
<pre><code class="lang-scala"><span class="token keyword">case</span> <span class="token keyword">class</span> Messages<span class="token punctuation">(</span>msgs<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> loadTime<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span>

<span class="token keyword">val</span> messageHandler <span class="token operator">=</span> <span class="token keyword">new</span> ActionHandler<span class="token punctuation">(</span>zoomRW<span class="token punctuation">(</span>_<span class="token punctuation">.</span>messages<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> m<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>messages <span class="token operator">=</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">def</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> LoadMessages<span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
      updated<span class="token punctuation">(</span>value<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>loadTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> loadMessagesEffect<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> NewMessages<span class="token punctuation">(</span>msgs<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
      updated<span class="token punctuation">(</span>Messages<span class="token punctuation">(</span>msgs<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>If you have no state change, use <code>effectOnly</code> and if you want your effects to be run in parallel (normally they are run in serial), use <code>updatedPar</code>. For example
we might want to get periodic notifications (using <code>runAfter</code>) while the messages are being loaded, to update the UI accordingly.</p>
<pre><code class="lang-scala">    <span class="token keyword">case</span> LoadMessages<span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
      updatedPar<span class="token punctuation">(</span>value<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>loadTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> loadMessagesEffect<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">,</span> runAfter<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">.</span>millis<span class="token punctuation">)</span><span class="token punctuation">(</span>StillLoading<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> NewMessages<span class="token punctuation">(</span>msgs<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
      updated<span class="token punctuation">(</span>Messages<span class="token punctuation">(</span>msgs<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> StillLoading <span class="token keyword">=&gt;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>loadTime <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        updated<span class="token punctuation">(</span>value<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>loadTime <span class="token operator">=</span> value<span class="token punctuation">.</span>loadTime <span class="token operator">+</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> runAfter<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">.</span>millis<span class="token punctuation">)</span><span class="token punctuation">(</span>StillLoading<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">else</span>
        noChange
</code></pre>
<p>Note how we need to update model when handling <code>StillLoading</code> because otherwise no views would be informed about the change.</p>
<p>For a more elaborate multi-state action management, take a look at <a href="../advanced/PotActions.html"><code>PotActions</code></a></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../usage/Views.html" class="navigation navigation-prev " aria-label="Previous page: Views"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../advanced/index.html" class="navigation navigation-next " aria-label="Next page: Advanced Topics"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-editlink/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-github/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"editlink":{"base":"https://github.com/ochrons/diode/tree/master/doc","label":"Edit This Page","multilingual":false},"github":{"url":"https://github.com/ochrons/diode/"},"prism":{},"search":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
