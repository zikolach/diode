<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Application Model | Diode</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.5.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-prism/prism.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../usage/Actions.html" />
    
    
    <link rel="prev" href="../usage/index.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="1.1" data-chapter-title="Application Model" data-filepath="usage/ApplicationModel.md" data-basepath=".." data-revision="Mon Nov 30 2015 14:42:05 GMT+0200 (FLE Standard Time)">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="usage/index.html">
            
                
                    <a href="../usage/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Usage
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.1" data-path="usage/ApplicationModel.html">
            
                
                    <a href="../usage/ApplicationModel.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Application Model
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="usage/Actions.html">
            
                
                    <a href="../usage/Actions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Actions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="usage/Handlers.html">
            
                
                    <a href="../usage/Handlers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Action Handlers
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="usage/Views.html">
            
                
                    <a href="../usage/Views.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Views
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="usage/Effects.html">
            
                
                    <a href="../usage/Effects.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Async Effects
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="advanced/index.html">
            
                
                    <a href="../advanced/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Advanced Topics
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="advanced/Pot.html">
            
                
                    <a href="../advanced/Pot.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Async Model Data
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="advanced/PotActions.html">
            
                
                    <a href="../advanced/PotActions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Stateful Actions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="advanced/ActionProcessors.html">
            
                
                    <a href="../advanced/ActionProcessors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Action Processors
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="UsageWithReact.html">
            
                
                    <a href="../UsageWithReact.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Usage with React
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Diode</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="application-model">Application Model</h1>
<p><img src="../images/architecture-model.png" style="float: right; padding: 10px">
Having all your application state in a single model may seem like a daunting design task, but it&apos;s not really that different from designing a hierarchical UI
layout. If you are used to having a distributed state between different stores and components, take some time to sit down and redesign the model as a single
hierarchy.</p>
<p>As the model has to be immutable, it makes sense to build it out of case classes. This provides us with many benefits down the line, such as pattern matching
and use of the <code>copy</code> method. For illustration purposes we&apos;ll define a simple case class hierarchy to represent the application model.</p>
<pre><code class="lang-scala"><span class="token keyword">case</span> <span class="token keyword">class</span> Root<span class="token punctuation">(</span>a<span class="token operator">:</span> A<span class="token punctuation">,</span> b<span class="token operator">:</span> B<span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span>
<span class="token keyword">case</span> <span class="token keyword">class</span> A<span class="token punctuation">(</span>d<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> e<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span>
<span class="token keyword">case</span> <span class="token keyword">class</span> B<span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span> g<span class="token operator">:</span> Option<span class="token punctuation">[</span>D<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">case</span> <span class="token keyword">class</span> D<span class="token punctuation">(</span>h<span class="token operator">:</span> Seq<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span>

<span class="token keyword">object</span> AppCircuit <span class="token keyword">extends</span> Circuit<span class="token punctuation">[</span>Root<span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre>
<p>Making modifications to an immutable model means making a copy of the model every time something changes. Naturally we&apos;ll want to modify only those parts of the
hierarchy that we absolutely need to, leaving the rest as it is. These changes can be visualized as below:
<img src="../images/model-updates.png" alt="Hierarchy"></p>
<ol>
<li>We want to change <code>B.f</code> to <code>false</code></li>
<li>To implement the change, we must also change <code>b</code> and <code>root</code> objects with <br><code>root = root.copy(b = root.b.copy(f = false))</code></li>
<li>Next we want to change <code>A.e</code> to <code>&quot;normal&quot;</code></li>
<li>To implement this change, we must also change <code>a</code> and <code>root</code> with <br><code>root = root.copy(a = root.a.copy(e = &quot;normal&quot;))</code></li>
</ol>
<p>All the other parts of the model hierarchy stay the same throughout these changes, so your render code can skip re-rendering <code>root.b.g</code> for example.</p>
<h2 id="accessing-the-model">Accessing the Model</h2>
<p>In Diode your application model is safely tucked inside the Circuit class, without any direct access. Instead you will get <em>indirect</em> access via readers and
writers. These are defined as <code>ModelR</code> and <code>ModelRW</code> traits.</p>
<p>For example if your view needs to render the sequence of <code>Int</code>s in <code>D</code>, it doesn&apos;t care where that data comes from as long as it has access to it. Furthermore,
since the state changes always create a new root model, we cannot simply give the current value and expect that to work in the future. What we need is a chain
of functions going from <code>root</code> all the way to the piece of data we are interested in. The classes implementing <code>ModelR</code> and <code>ModelRW</code> provide this. To build a
reader to <code>root.b.g.h</code> we would write:</p>
<pre><code class="lang-scala"><span class="token keyword">val</span> reader<span class="token operator">:</span> ModelR<span class="token punctuation">[</span>Option<span class="token punctuation">[</span>Seq<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> RootModelR<span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">.</span>zoom<span class="token punctuation">(</span>_<span class="token punctuation">.</span>g<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>Because we have an <code>Option[D]</code> on the path, we need to use <code>map</code> to access the contents of <code>D</code>, thus leaving us with an <code>Option[Seq[Int]]</code> reader. To get the
current value from the reader we simply call <code>reader.value</code>.</p>
<p>The <code>Circuit</code> provides <code>zoom</code> and <code>zoomRW</code> functions to zoom into the application model, so we can rewrite the previous example as:</p>
<pre><code class="lang-scala"><span class="token keyword">val</span> reader<span class="token operator">:</span> ModelR<span class="token punctuation">[</span>Option<span class="token punctuation">[</span>Seq<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> AppCircuit<span class="token punctuation">.</span>zoom<span class="token punctuation">(</span>_<span class="token punctuation">.</span>g<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>Note that you don&apos;t need to specify the types for the readers, they are automatically inferred. They are displayed here for clarity.</p>
<h3 id="complex-access-patterns">Complex Access Patterns</h3>
<p>We are not limited to traversing the hierarchy to get a reader for just a single value. Since we get to define the access function ourselves, we can freely
access anything in the model and return a composite.</p>
<pre><code class="lang-scala"><span class="token keyword">val</span> complexReader<span class="token operator">:</span> ModelR<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span> Option<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> 
  AppCircuit<span class="token punctuation">.</span>zoom<span class="token punctuation">(</span>r <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>a<span class="token punctuation">.</span>e<span class="token punctuation">,</span> r<span class="token punctuation">.</span>b<span class="token punctuation">.</span>f<span class="token punctuation">,</span> r<span class="token punctuation">.</span>g<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>This helps detaching the application model from the UI hierarchy, as you can keep your data in a sensible structure while allowing your UI components to access
it in a natural way.</p>
<h3 id="modifications-through-writers">Modifications through Writers</h3>
<p>The <code>ModelRW</code> trait adds functionality to update the model. In addition to providing a function for reading a value, it requires a second function
for updating.</p>
<pre><code class="lang-scala"><span class="token keyword">val</span> rwForA<span class="token operator">:</span> ModelRW<span class="token punctuation">[</span>Root<span class="token punctuation">,</span> A<span class="token punctuation">]</span> <span class="token operator">=</span> AppCircuit<span class="token punctuation">.</span>zoomRW<span class="token punctuation">(</span>_<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> m<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>a <span class="token operator">=</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> rwForA_e<span class="token operator">:</span> ModelRW<span class="token punctuation">[</span>Root<span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> rwForA<span class="token punctuation">.</span>zoomRW<span class="token punctuation">(</span>_<span class="token punctuation">.</span>e<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> m<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>e <span class="token operator">=</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>This time we are defining the writer in two steps to take advantage of the provided function composition. To make the update, just call <code>updated</code>.</p>
<pre><code class="lang-scala"><span class="token keyword">val</span> newRoot<span class="token operator">:</span> Root <span class="token operator">=</span> rwForA_e<span class="token punctuation">.</span>updated<span class="token punctuation">(</span><span class="token string">&quot;New value!&quot;</span><span class="token punctuation">)</span>
</code></pre>
<p>Since <code>Circuit</code> doesn&apos;t allow us to change the internal model directly, we are just storing a copy for demonstration purposes. Only way to make actual changes
to the model is to dispatch and handle <a href="Actions.html">actions</a>.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../usage/index.html" class="navigation navigation-prev " aria-label="Previous page: Usage"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../usage/Actions.html" class="navigation navigation-next " aria-label="Next page: Actions"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-editlink/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-github/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"editlink":{"base":"https://github.com/ochrons/diode/tree/master/doc","label":"Edit This Page","multilingual":false},"github":{"url":"https://github.com/ochrons/diode/"},"prism":{},"search":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
