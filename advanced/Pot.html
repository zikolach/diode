<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Async Model Data | Diode</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.5.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-prism/prism.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../advanced/PotActions.html" />
    
    
    <link rel="prev" href="../advanced/index.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="2.1" data-chapter-title="Async Model Data" data-filepath="advanced/Pot.md" data-basepath=".." data-revision="Mon Nov 30 2015 14:42:05 GMT+0200 (FLE Standard Time)">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="usage/index.html">
            
                
                    <a href="../usage/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Usage
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="usage/ApplicationModel.html">
            
                
                    <a href="../usage/ApplicationModel.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Application Model
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="usage/Actions.html">
            
                
                    <a href="../usage/Actions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Actions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="usage/Handlers.html">
            
                
                    <a href="../usage/Handlers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Action Handlers
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="usage/Views.html">
            
                
                    <a href="../usage/Views.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Views
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="usage/Effects.html">
            
                
                    <a href="../usage/Effects.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Async Effects
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="advanced/index.html">
            
                
                    <a href="../advanced/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Advanced Topics
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="2.1" data-path="advanced/Pot.html">
            
                
                    <a href="../advanced/Pot.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Async Model Data
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="advanced/PotActions.html">
            
                
                    <a href="../advanced/PotActions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Stateful Actions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="advanced/ActionProcessors.html">
            
                
                    <a href="../advanced/ActionProcessors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Action Processors
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="UsageWithReact.html">
            
                
                    <a href="../UsageWithReact.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Usage with React
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Diode</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="async-model-data">Async Model Data</h1>
<p>In real applications you quite often have to deal with model data that is asynchronously loaded or updated. Usual approach would be to use <code>Option[A]</code> to
indicate whether data is there or not, but then you cannot deal with error situations. Using <code>Either[ErrorType, Option[A]]</code> or <code>Try[Option[A]]</code> gives your some
control over errors, but if you consider refreshing old data and getting an error back, what should the result be? Not to mention knowing how long the async
operation has been running and notifying the user when it has been delayed for too long. Clearly the existing data containers are not enough for this.</p>
<h2 id="potential-data">Potential Data</h2>
<p><img src="../images/pot-states.png" style="float: right; padding: 10px" ;="">
A <code>Pot[+A]</code> represents <em>potential</em> data that may exist in six different states as seen in the picture on the right. <code>Pot</code> provides you with the same interface as
<code>Option</code> or <code>Try</code>, making it very easy to use in your existing application code. Things like <em>for comprehension</em>, <code>getOrElse</code> or even <code>recover</code> are supported.
Like <code>Option</code>, <code>Pot</code> is immutable and you have to create a new <code>Pot</code> when the state or content changes.</p>
<p><code>Pot</code> usually starts as an <code>Empty</code> (option <code>None</code>) or <code>Ready</code> (option <code>Some</code>), depending on whether you have the data available or not. You can use the <code>empty</code>
method to create a correctly typed <code>Empty</code>.</p>
<pre><code class="lang-scala"><span class="token keyword">var</span> myData <span class="token operator">=</span> Pot<span class="token punctuation">.</span>empty<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// myData is now Empty</span>
</code></pre>
<p>When you make an async call to fetch data, change the state to <code>Pending</code> with the help of <code>pending</code> function.</p>
<pre><code class="lang-scala">myData <span class="token operator">=</span> myData<span class="token punctuation">.</span>pending<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// myData is now Pending</span>
</code></pre>
<p>Assuming you get a successful response from the server, you can change the state to <code>Ready</code>.</p>
<pre><code class="lang-scala">myData <span class="token operator">=</span> myValue<span class="token punctuation">.</span>ready<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// myData is now Ready(data)</span>
</code></pre>
<p>In case something went wrong, you can store the exception in the <code>Failed</code> state.</p>
<pre><code class="lang-scala">myData <span class="token operator">=</span> myData<span class="token punctuation">.</span>fail<span class="token punctuation">(</span>exception<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// myData is now Failed(exception)</span>
</code></pre>
<p>When you are ready to refresh your <code>Ready</code> data, you again call <code>pending</code> but this time it results in a <code>PendingStale</code> indicating that old data is still there to be
used while new data is fetched.</p>
<pre><code class="lang-scala">myData <span class="token operator">=</span> myData<span class="token punctuation">.</span>pending<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// myData is now PendingStale(data)</span>
</code></pre>
<p>In case the async call gets new results, the state goes to <code>Ready(newData)</code> but if something goes wrong, you&apos;ll end up with <code>FailedStale</code> containing the
old data.</p>
<pre><code class="lang-scala">myData <span class="token operator">=</span> myData<span class="token punctuation">.</span>fail<span class="token punctuation">(</span>exception<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// myData is now FailedStale(data, exception)</span>
</code></pre>
<h3 id="usage">Usage</h3>
<p><code>Pot</code> exposes its state via following functions.</p>
<pre><code class="lang-scala"><span class="token keyword">def</span> isEmpty<span class="token operator">:</span> <span class="token builtin">Boolean</span>
<span class="token keyword">def</span> nonEmpty <span class="token operator">=</span> <span class="token operator">!</span>isEmpty
<span class="token keyword">def</span> isPending<span class="token operator">:</span> <span class="token builtin">Boolean</span>
<span class="token keyword">def</span> isStale<span class="token operator">:</span> <span class="token builtin">Boolean</span>
<span class="token keyword">def</span> isFailed<span class="token operator">:</span> <span class="token builtin">Boolean</span>
<span class="token keyword">def</span> isReady<span class="token operator">:</span> <span class="token builtin">Boolean</span>
<span class="token keyword">def</span> state<span class="token operator">:</span> PotState
</code></pre>
<p>You can query specific state via <code>isX</code> functions, or use <code>state</code> for matching. Note that <code>isEmpty</code> means there is no data in the <code>Pot</code>, so states <code>Pending</code> and
<code>Failed</code>, in addition to <code>Empty</code>, all return <code>true</code>.</p>
<p>Otherwise a <code>Pot</code> works like an <code>Option</code> (<code>Empty</code>, <code>Pending</code> and <code>Failed</code> work like <code>None</code>).</p>
<h3 id="retries">Retries</h3>
<p>A common pattern with async data is to retry failed loads a few times. <code>Pot</code> supports this pattern by providing a retry policy (<code>retryPolicy</code>) and some state
management to deal with retries. A typical case is to check for retry after <code>Pot</code> goes into failed state and then retry the operation like in the example below:</p>
<pre><code class="lang-scala"><span class="token keyword">val</span> value<span class="token operator">:</span> Pot<span class="token punctuation">[</span>A<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">case</span> PotEmpty <span class="token keyword">=&gt;</span>
  updated<span class="token punctuation">(</span>value<span class="token punctuation">.</span>pending<span class="token punctuation">(</span>retries<span class="token punctuation">)</span><span class="token punctuation">,</span> updateEffect<span class="token punctuation">)</span>
<span class="token keyword">case</span> PotFailed <span class="token keyword">=&gt;</span>
  value<span class="token punctuation">.</span>retryPolicy<span class="token punctuation">.</span>retry<span class="token punctuation">(</span>action<span class="token punctuation">.</span>value<span class="token punctuation">,</span> updateEffect<span class="token punctuation">)</span> <span class="token keyword">match</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> Right<span class="token punctuation">(</span><span class="token punctuation">(</span>nextPolicy<span class="token punctuation">,</span> retryEffect<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
      updated<span class="token punctuation">(</span>value<span class="token punctuation">.</span>retry<span class="token punctuation">(</span>nextPolicy<span class="token punctuation">)</span><span class="token punctuation">,</span> retryEffect<span class="token punctuation">)</span>
    <span class="token keyword">case</span> Left<span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
      updated<span class="token punctuation">(</span>value<span class="token punctuation">.</span>fail<span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre>
<p>The <code>Pot.retry</code> function sets the <code>Pot</code> into <code>Pending</code> (or <code>PendingStale</code>) state and updates <code>retryPolicy</code>. Common retry policies <code>Immediate</code> and <code>Backoff</code> are
available in the <code>Retry</code> object, but feel free to roll your own.</p>
<h3 id="waiting-time">Waiting Time</h3>
<p>The pending states of <code>Pot</code> store a time value when created. You can access this through <code>startTime</code>, or you can directly get the duration of the operation
with <code>duration(currentTime)</code>. This is useful in an user interface, where you&apos;ll want to show an indicator if the operation is taking too long. If
an operation fails and you retry it, the <code>startTime</code> will remain the same, giving you the total duration of the retried operations.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../advanced/index.html" class="navigation navigation-prev " aria-label="Previous page: Advanced Topics"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../advanced/PotActions.html" class="navigation navigation-next " aria-label="Next page: Stateful Actions"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-editlink/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-github/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"editlink":{"base":"https://github.com/ochrons/diode/tree/master/doc","label":"Edit This Page","multilingual":false},"github":{"url":"https://github.com/ochrons/diode/"},"prism":{},"search":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
